<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nara - Hindu AI Assistant</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background-color: #ffffff;
            color: #374151;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .main-container {
            flex: 1;
            display: flex;
            flex-direction: row;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
            position: relative;
            min-height: calc(100vh - 40px);
        }

        .main-content {
            width: 768px;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: absolute;
            left: 50%;
            transform: translateX(-50%);
            padding-bottom: 30px;
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 20px;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .main-heading {
            font-size: 2rem;
            font-weight: 400;
            color: #374151;
            margin-bottom: 16px;
        }

        .om-symbol {
            font-size: 4rem;
            color: #FF6F00;
            margin-bottom: 20px;
            font-family: Arial, sans-serif;
            text-align: center;
            width: 100%;
        }

        .subtitle {
            font-size: 1rem;
            color: #6b7280;
            margin-bottom: 32px;
        }

        .chat-input-container {
            width: 100%;
            max-width: 768px;
            margin: -10px auto 0;
            padding: 5px 20px;
            position: relative;
        }

        .input-wrapper {
            position: relative;
            background: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 24px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.02), 0 1px 3px rgba(0, 0, 0, 0.1);
            transition: all 0.2s ease;
        }

        .input-wrapper:focus-within {
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .language-select {
            padding: 6px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 14px;
            color: #374151;
            background-color: #f9fafb;
            cursor: pointer;
            outline: none;
        }

        .language-select:focus {
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.1);
        }

        .language-indicator {
            font-size: 0.8rem;
            color: #6b7280;
            margin-top: 4px;
            text-align: right;
        }

        #questionInput {
            flex: 1;
            border: none;
            outline: none;
            font-size: 16px;
            font-family: inherit;
            background: transparent;
            color: #374151;
            resize: none;
            min-height: 24px;
            max-height: 200px;
            line-height: 1.6;
        }

        #questionInput::placeholder {
            color: #9ca3af;
        }

        .input-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .mic-button, .send-button {
            background: none;
            border: none;
            padding: 8px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.2s;
        }

        .mic-button {
            color: #6b7280;
        }

        .mic-button:hover {
            background-color: #f3f4f6;
        }

        .send-button {
            background-color: #000000;
            color: white;
            width: 32px;
            height: 32px;
            border-radius: 8px;
        }

        .send-button:hover:not(:disabled) {
            background-color: #1f2937;
        }

        .send-button:disabled {
            background-color: #d1d5db;
            cursor: not-allowed;
        }

        .chat-messages {
            width: 100%;
            max-width: 768px;
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: none;
            margin-bottom: 5px;
        }

        .message {
            margin-bottom: 12px;
            padding: 12px;
            border-radius: 8px;
            line-height: 1.6;
        }

        .message.user {
            background-color: #f8fafc;
            margin-left: 10%;
        }

        .message.assistant {
            background-color: #ffffff;
            border: 1px solid #e5e7eb;
        }

        .loading {
            text-align: center;
            color: #6b7280;
            font-style: italic;
            padding: 20px;
        }

        .error {
            color: #dc2626;
            background-color: #fef2f2;
            border: 1px solid #fecaca;
            padding: 12px;
            border-radius: 8px;
            margin-top: 12px;
        }

        .suggestions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 12px;
            margin-bottom: 32px;
            width: 100%;
            max-width: 768px;
        }

        .suggestion-card {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
        }

        .suggestion-card:hover {
            background: #f3f4f6;
            border-color: #d1d5db;
        }

        .suggestion-title {
            font-weight: 500;
            margin-bottom: 4px;
            color: #374151;
        }

        .suggestion-subtitle {
            font-size: 14px;
            color: #6b7280;
        }

        /* Icons */
        .icon {
            width: 16px;
            height: 16px;
        }

        .daily-verse-section {
            width: auto;
            background: #fff9f0;
            border: 1px solid #ffd7a8;
            border-radius: 16px;
            padding: 16px 24px;
            position: fixed;
            top: 20px;
            right: max(20px, calc((100vw - 1400px) / 2 + 20px));
            z-index: 1;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .daily-verse-section:hover {
            background: #fff5e6;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .verse-popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        .verse-popup {
            background: #fff;
            border-radius: 16px;
            padding: 32px;
            width: 90%;
            max-width: 600px;
            position: relative;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .close-popup {
            position: absolute;
            top: 16px;
            right: 16px;
            background: none;
            border: none;
            font-size: 24px;
            color: #666;
            cursor: pointer;
            padding: 4px;
            line-height: 1;
        }

        .close-popup:hover {
            color: #000;
        }

        .daily-verse-title {
            font-size: 1.25rem;
            color: #FF7F00;
            margin-bottom: 16px;
            text-align: center;
            font-weight: 500;
        }

        .verse-content {
            font-size: 1rem;
            color: #374151;
            margin-bottom: 16px;
            line-height: 1.6;
            font-style: italic;
        }

        .verse-transliteration {
            font-size: 0.95rem;
            color: #4b5563;
            margin-bottom: 16px;
            line-height: 1.6;
            font-style: italic;
        }

        .verse-meaning {
            font-size: 0.95rem;
            color: #4b5563;
            margin-bottom: 16px;
            line-height: 1.6;
            padding-top: 8px;
            border-top: 1px solid #ffd7a8;
        }

        .verse-section-label {
            font-size: 0.8rem;
            color: #FF7F00;
            margin-bottom: 4px;
            font-weight: 500;
        }

        .verse-reference {
            font-size: 0.875rem;
            color: #FF7F00;
            text-align: right;
            font-weight: 500;
        }

        @media (max-width: 1400px) {
            .daily-verse-section {
                right: 20px;
            }
        }

        @media (max-width: 1024px) {
            .main-container {
                flex-direction: column;
                align-items: center;
            }

            .main-content {
                position: static;
                width: 100%;
                max-width: 768px;
                transform: none;
            }

            .daily-verse-section {
                position: static;
                width: 100%;
                max-width: 768px;
                margin: 40px 0;
            }
        }

        .home-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: #fff;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            padding: 8px 16px;
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .home-button:hover {
            background: #f3f4f6;
            transform: translateY(-1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .home-button svg {
            width: 20px;
            height: 20px;
            color: #FF6F00;
        }

        .home-button span {
            color: #374151;
            font-weight: 500;
        }
    </style>
</head>
<body>
    <button class="home-button" onclick="goHome()">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" />
        </svg>
        <span>Home</span>
    </button>

    <div class="main-container">
        <div class="main-content">
            <div class="welcome-section" id="welcomeSection">
                <div class="om-symbol">ॐ</div>
                <h1 class="main-heading">What would you like to explore?</h1>
                <p class="subtitle">Ask questions about Hindu philosophy, sacred texts, and ancient wisdom</p>
                
                <div class="suggestions" id="suggestions">
                    <div class="suggestion-card" onclick="fillQuestion('What is the meaning of dharma?')">
                        <div class="suggestion-title">Understand Dharma</div>
                        <div class="suggestion-subtitle">Explore the concept of righteous living</div>
                    </div>
                    <div class="suggestion-card" onclick="fillQuestion('Explain the Bhagavad Gita verse 2.47')">
                        <div class="suggestion-title">Gita Wisdom</div>
                        <div class="suggestion-subtitle">Dive into sacred verse meanings</div>
                    </div>
                    <div class="suggestion-card" onclick="fillQuestion('What are the different paths of yoga?')">
                        <div class="suggestion-title">Paths of Yoga</div>
                        <div class="suggestion-subtitle">Learn about spiritual practices</div>
                    </div>
                    <div class="suggestion-card" onclick="fillQuestion('How can Vedic wisdom help with modern stress?')">
                        <div class="suggestion-title">Ancient Solutions</div>
                        <div class="suggestion-subtitle">Apply timeless wisdom to today</div>
                    </div>
                </div>
            </div>

            <div class="chat-messages" id="chatMessages">
                <!-- Messages will be added here dynamically -->
            </div>
        </div>

        <div class="daily-verse-section" onclick="showVersePopup()">
            <h2 class="daily-verse-title">Today's Gita Verse</h2>
            <div class="verse-reference" id="verseReference">
                Bhagavad Gita 2.47
            </div>
        </div>

        <div class="verse-popup-overlay" id="versePopup" onclick="hideVersePopup(event)">
            <div class="verse-popup">
                <button class="close-popup" onclick="hideVersePopup(event)">×</button>
                <h2 class="daily-verse-title">Today's Gita Verse</h2>
                <div>
                    <div class="verse-section-label">Sanskrit</div>
                    <div class="verse-content" id="verseText"></div>
                </div>
                <div>
                    <div class="verse-section-label">Transliteration</div>
                    <div class="verse-transliteration" id="verseTransliteration"></div>
                </div>
                <div>
                    <div class="verse-section-label">Meaning</div>
                    <div class="verse-meaning" id="verseMeaning"></div>
                </div>
                <div class="verse-reference" id="popupVerseReference"></div>
            </div>
        </div>
    </div>

    <div class="chat-input-container">
        <div class="input-wrapper">
            <textarea 
                id="questionInput" 
                placeholder="Ask anything about Hindu philosophy..."
                rows="1"
                oninput="autoResize(this)"
                onkeydown="handleKeyPress(event)"
            ></textarea>
            <div class="input-actions">
                <select class="language-select" id="languageSelect" onchange="updateLanguageIndicator()">
                    <option value="english">English</option>
                    <option value="sanskrit">Sanskrit</option>
                    <option value="hindi">Hindi</option>
                    <option value="tamil">Tamil</option>
                    <option value="telugu">Telugu</option>
                    <option value="kannada">Kannada</option>
                    <option value="malayalam">Malayalam</option>
                </select>
                <button class="mic-button" onclick="toggleMic()">
                    <svg class="icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"/>
                        <path d="M12 19v4"/>
                        <path d="M8 23h8"/>
                    </svg>
                </button>
                <button class="send-button" onclick="askQuestion()" id="sendButton" disabled>
                    <svg class="icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>
                    </svg>
                </button>
            </div>
        </div>
        <div class="language-indicator" id="languageIndicator"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000/api/ask';
        const questionInput = document.getElementById('questionInput');
        const sendButton = document.getElementById('sendButton');
        const chatMessages = document.getElementById('chatMessages');
        const welcomeSection = document.getElementById('welcomeSection');
        let hasStartedChat = false;

        const verses = [
            {
                sanskrit: "कर्मण्येवाधिकारस्ते मा फलेषु कदाचन।\nमा कर्मफलहेतुर्भूर्मा ते सङ्गोऽस्त्वकर्मणि॥",
                transliteration: "karmaṇy-evādhikāras te mā phaleṣu kadācana\nmā karma-phala-hetur bhūr mā te saṅgo 'stv akarmaṇi",
                meaning: "You have a right to perform your prescribed duties, but you are not entitled to the fruits of your actions. Never consider yourself to be the cause of the results of your activities, nor be attached to inaction.",
                reference: "Bhagavad Gita 2.47"
            },
            {
                sanskrit: "योगस्थः कुरु कर्माणि सङ्गं त्यक्त्वा धनञ्जय।\nसिद्ध्यसिद्ध्योः समो भूत्वा समत्वं योग उच्यते॥",
                transliteration: "yoga-sthaḥ kuru karmāṇi saṅgaṁ tyaktvā dhanañjaya\nsiddhy-asiddhyoḥ samo bhūtvā samatvaṁ yoga ucyate",
                meaning: "Perform your duty equipoised, O Arjuna, abandoning all attachment to success or failure. Such equanimity is called yoga.",
                reference: "Bhagavad Gita 2.48"
            },
            {
                sanskrit: "यदा यदा हि धर्मस्य ग्लानिर्भवति भारत।\nअभ्युत्थानमधर्मस्य तदात्मानं सृजाम्यहम्॥",
                transliteration: "yadā yadā hi dharmasya glānir bhavati bhārata\nabhyutthānam adharmasya tadātmānaṁ sṛjāmy aham",
                meaning: "Whenever and wherever there is a decline in religious practice, O descendant of Bharata, and a predominant rise of irreligion—at that time I descend Myself.",
                reference: "Bhagavad Gita 4.7"
            }
        ];

        // Function to show verse popup
        function showVersePopup() {
            const popup = document.getElementById('versePopup');
            popup.style.display = 'flex';
            document.body.style.overflow = 'hidden'; // Prevent scrolling when popup is open
        }

        // Function to hide verse popup
        function hideVersePopup(event) {
            if (event.target.classList.contains('verse-popup-overlay') || 
                event.target.classList.contains('close-popup')) {
                const popup = document.getElementById('versePopup');
                popup.style.display = 'none';
                document.body.style.overflow = 'auto'; // Restore scrolling
            }
        }

        // Modified setDailyVerse function
        function setDailyVerse() {
            const today = new Date();
            const verseIndex = today.getDate() % verses.length;
            const verse = verses[verseIndex];
            
            // Update popup content
            document.getElementById('verseText').innerHTML = verse.sanskrit.replace(/\n/g, '<br>');
            document.getElementById('verseTransliteration').innerHTML = verse.transliteration.replace(/\n/g, '<br>');
            document.getElementById('verseMeaning').innerHTML = verse.meaning;
            
            // Update both reference displays
            document.getElementById('verseReference').textContent = verse.reference;
            document.getElementById('popupVerseReference').textContent = verse.reference;
        }

        // Call this when the page loads
        window.addEventListener('load', setDailyVerse);

        // Auto-resize textarea
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
            
            // Enable/disable send button based on content
            sendButton.disabled = !textarea.value.trim();
        }

        // Handle Enter key (Shift+Enter for new line, Enter to send)
        function handleKeyPress(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                askQuestion();
            }
        }

        // Fill question from suggestion
        function fillQuestion(text) {
            questionInput.value = text;
            autoResize(questionInput);
            questionInput.focus();
        }

        // Toggle microphone (placeholder)
        function toggleMic() {
            console.log('Mic clicked');
        }

        // Start chat mode
        function startChatMode() {
            if (!hasStartedChat) {
                welcomeSection.style.display = 'none';
                chatMessages.style.display = 'block';
                hasStartedChat = true;
            }
        }

        // Add message to chat
        function addMessage(content, type = 'assistant') {
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.innerHTML = formatResponse(content);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Function to update language indicator
        function updateLanguageIndicator() {
            const selectedLanguage = document.getElementById('languageSelect').value;
            const indicator = document.getElementById('languageIndicator');
            indicator.textContent = `Responses will be in ${selectedLanguage.charAt(0).toUpperCase() + selectedLanguage.slice(1)}`;
            
            // Store language preference
            localStorage.setItem('preferredLanguage', selectedLanguage);
            
            console.log('Language updated to:', selectedLanguage); // Debug log
        }

        async function askQuestion() {
            const question = questionInput.value.trim();
            if (!question) return;

            startChatMode();
            
            const selectedLanguage = document.getElementById('languageSelect').value;
            console.log('Selected language:', selectedLanguage);
            
            // Add user message
            addMessage(question, 'user');
            
            // Clear input
            questionInput.value = '';
            autoResize(questionInput);
            
            // Add loading message
            const loadingDiv = document.createElement('div');
            loadingDiv.className = 'message assistant loading';
            loadingDiv.innerHTML = `Thinking... (Response will be in ${selectedLanguage})`;
            chatMessages.appendChild(loadingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept-Language': selectedLanguage
                    },
                    body: JSON.stringify({
                        question: question,
                        user_id: 'test-user',
                        get_analysis: false,
                        language: selectedLanguage,
                        source_language: 'english',
                        response_type: 'direct',
                        require_answer: true,
                        max_context_length: 1000
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Received response:', data);
                
                // Remove loading message
                chatMessages.removeChild(loadingDiv);
                
                if (!data.response.trim()) {
                    addMessage(`<div class="error">I apologize, but I couldn't find a direct answer to your question. Could you please rephrase it?</div>`);
                } else if (data.language !== selectedLanguage) {
                    // More detailed error message about translation issues
                    const errorDetails = `
                        <div class="error">
                            <p>Translation Service Status:</p>
                            <ul>
                                <li>Requested Language: ${selectedLanguage}</li>
                                <li>Current Status: Translation service temporarily unavailable</li>
                                <li>Alternative: Showing response in English</li>
                            </ul>
                            <p>Our team has been notified and is working to restore full translation capabilities. You can:</p>
                            <ul>
                                <li>Try again in a few minutes</li>
                                <li>Temporarily switch to English</li>
                                <li>Continue viewing responses in English until the service is restored</li>
                            </ul>
                        </div>
                    `;
                    addMessage(errorDetails);
                    addMessage(data.response);
                } else {
                    addMessage(data.response);
                }
                
            } catch (error) {
                chatMessages.removeChild(loadingDiv);
                const errorMessage = `
                    <div class="error">
                        <p>Translation Error Details:</p>
                        <ul>
                            <li>Requested Language: ${selectedLanguage}</li>
                            <li>Error Type: ${error.name}</li>
                            <li>Error Message: ${error.message}</li>
                        </ul>
                        <p>This might be due to:</p>
                        <ul>
                            <li>Network connectivity issues</li>
                            <li>Translation service maintenance</li>
                            <li>Temporary service disruption</li>
                        </ul>
                    </div>
                `;
                addMessage(errorMessage);
                console.error('Error details:', error);
            }
        }

        function formatResponse(text) {
            // Handle basic markdown formatting
            let formatted = text
                // Convert headers
                .replace(/### (.*$)/gm, '<h3>$1</h3>')
                .replace(/## (.*$)/gm, '<h2>$1</h2>')
                .replace(/# (.*$)/gm, '<h1>$1</h1>')
                // Convert bold text
                .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                // Convert italic text
                .replace(/\*(.*?)\*/g, '<em>$1</em>')
                // Convert paragraph breaks (double newlines to paragraph tags)
                .replace(/\n\n/g, '</p><p>')
                // Convert single newlines to line breaks
                .replace(/\n/g, '<br>')
                // Wrap the entire content in paragraph tags
                .replace(/^(.*)$/s, '<p>$1</p>')
                // Clean up any empty paragraphs
                .replace(/<p><\/p>/g, '')
                .replace(/<p><br><\/p>/g, '')
                // Fix header tags that got wrapped in paragraphs
                .replace(/<p>(<h[1-6]>.*?<\/h[1-6]>)<\/p>/g, '$1')
                // Fix consecutive paragraph issues
                .replace(/<\/p><p>/g, '</p>\n<p>');
            
            return formatted;
        }

        // Initialize with stored language preference
        window.addEventListener('load', function() {
            const storedLanguage = localStorage.getItem('preferredLanguage');
            if (storedLanguage) {
                document.getElementById('languageSelect').value = storedLanguage;
            }
            setDailyVerse();
            updateLanguageIndicator();
        });

        // Initialize
        questionInput.addEventListener('input', function() {
            autoResize(this);
        });

        // Function to go back to home screen
        function goHome() {
            // Clear chat messages
            const chatMessages = document.getElementById('chatMessages');
            chatMessages.innerHTML = '';
            chatMessages.style.display = 'none';

            // Show welcome section
            const welcomeSection = document.getElementById('welcomeSection');
            welcomeSection.style.display = 'block';

            // Clear input
            const questionInput = document.getElementById('questionInput');
            questionInput.value = '';
            autoResize(questionInput);

            // Reset hasStartedChat flag
            hasStartedChat = false;

            // Scroll to top
            window.scrollTo(0, 0);
        }
    </script>
</body>
</html> 